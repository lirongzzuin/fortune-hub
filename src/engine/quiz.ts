import {
  GenerateResultOutput,
  SeedContext,
} from './types';
import { seedIndex, seedPick } from './hash';

// ìƒì‹ í€´ì¦ˆ ë¬¸ì œ í’€
const QUIZ_POOL = [
  { q: 'ëŒ€í•œë¯¼êµ­ì˜ ìˆ˜ë„ëŠ”?', options: ['ì„œìš¸', 'ë¶€ì‚°', 'ëŒ€ì „', 'ì¸ì²œ'], answer: 0 },
  { q: 'ë¬¼ì˜ í™”í•™ì‹ì€?', options: ['H2O', 'CO2', 'NaCl', 'O2'], answer: 0 },
  { q: 'ì§€êµ¬ì—ì„œ ê°€ì¥ í° ëŒ€ì–‘ì€?', options: ['íƒœí‰ì–‘', 'ëŒ€ì„œì–‘', 'ì¸ë„ì–‘', 'ë¶ê·¹í•´'], answer: 0 },
  { q: 'ë¹›ì˜ 3ì›ìƒ‰ì´ ì•„ë‹Œ ê²ƒì€?', options: ['ë…¸ë€ìƒ‰', 'ë¹¨ê°„ìƒ‰', 'ì´ˆë¡ìƒ‰', 'íŒŒë€ìƒ‰'], answer: 0 },
  { q: '1ë…„ì€ ëª‡ ì£¼ì¸ê°€?', options: ['52ì£¼', '48ì£¼', '56ì£¼', '50ì£¼'], answer: 0 },
  { q: 'ì»¤í”¼ ì›ë‘ì˜ ì›ì‚°ì§€ë¡œ ì•Œë ¤ì§„ ë‚˜ë¼ëŠ”?', options: ['ì—í‹°ì˜¤í”¼ì•„', 'ë¸Œë¼ì§ˆ', 'ì½œë¡¬ë¹„ì•„', 'ë² íŠ¸ë‚¨'], answer: 0 },
  { q: 'ì¸ì²´ì—ì„œ ê°€ì¥ í° ì¥ê¸°ëŠ”?', options: ['í”¼ë¶€', 'ê°„', 'í', 'ë‡Œ'], answer: 0 },
  { q: 'DNAì˜ ì´ì¤‘ë‚˜ì„  êµ¬ì¡°ë¥¼ ë°œê²¬í•œ ì‚¬ëŒì€?', options: ['ì™“ìŠ¨ê³¼ í¬ë¦­', 'ë‰´í„´', 'ì•„ì¸ìŠˆíƒ€ì¸', 'ë‹¤ìœˆ'], answer: 0 },
  { q: 'ì„¸ê³„ì—ì„œ ê°€ì¥ ê¸´ ê°•ì€?', options: ['ë‚˜ì¼ê°•', 'ì•„ë§ˆì¡´ê°•', 'ì–‘ì¯”ê°•', 'ë¯¸ì‹œì‹œí”¼ê°•'], answer: 0 },
  { q: 'í•œê¸€ì„ ì°½ì œí•œ ì™•ì€?', options: ['ì„¸ì¢…ëŒ€ì™•', 'íƒœì¢…', 'ì˜ì¡°', 'ì •ì¡°'], answer: 0 },
  { q: 'ì˜¬ë¦¼í”½ì€ ëª‡ ë…„ë§ˆë‹¤ ì—´ë¦¬ë‚˜?', options: ['4ë…„', '2ë…„', '3ë…„', '5ë…„'], answer: 0 },
  { q: 'ì§€êµ¬ì˜ ìì „ ì£¼ê¸°ëŠ”?', options: ['ì•½ 24ì‹œê°„', 'ì•½ 12ì‹œê°„', 'ì•½ 48ì‹œê°„', 'ì•½ 36ì‹œê°„'], answer: 0 },
  { q: 'ëŒ€í•œë¯¼êµ­ì˜ êµ­í™”ëŠ”?', options: ['ë¬´ê¶í™”', 'ì¥ë¯¸', 'ë²šê½ƒ', 'ì§„ë‹¬ë˜'], answer: 0 },
  { q: 'ë°”ì´ëŸ¬ìŠ¤ì™€ ì„¸ê·  ì¤‘ í•­ìƒì œê°€ íš¨ê³¼ ìˆëŠ” ê²ƒì€?', options: ['ì„¸ê· ', 'ë°”ì´ëŸ¬ìŠ¤', 'ë‘˜ ë‹¤', 'ë‘˜ ë‹¤ ì•„ë‹˜'], answer: 0 },
  { q: 'íƒœì–‘ê³„ì—ì„œ ê°€ì¥ í° í–‰ì„±ì€?', options: ['ëª©ì„±', 'í† ì„±', 'í•´ì™•ì„±', 'ì²œì™•ì„±'], answer: 0 },
  { q: 'ì…°ìµìŠ¤í”¼ì–´ì˜ 4ëŒ€ ë¹„ê·¹ì´ ì•„ë‹Œ ê²ƒì€?', options: ['ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£', 'í–„ë¦¿', 'ì˜¤ì…€ë¡œ', 'ë§¥ë² ìŠ¤'], answer: 0 },
  { q: 'í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ì—ì„œ ë¹—ë³€ì˜ ì œê³±ì€?', options: ['ë‚˜ë¨¸ì§€ ë‘ ë³€ì˜ ì œê³±ì˜ í•©', 'ë‚˜ë¨¸ì§€ ë‘ ë³€ì˜ ê³±', 'ë‚˜ë¨¸ì§€ ë‘ ë³€ì˜ í•©', 'ë‚˜ë¨¸ì§€ ë‘ ë³€ì˜ ì œê³±ì˜ ê³±'], answer: 0 },
  { q: 'ë¹„íƒ€ë¯¼Cê°€ í’ë¶€í•œ ê³¼ì¼ì€?', options: ['í‚¤ìœ„', 'ë°”ë‚˜ë‚˜', 'ì‚¬ê³¼', 'í¬ë„'], answer: 0 },
  { q: 'ì„¸ê³„ì—ì„œ ì¸êµ¬ê°€ ê°€ì¥ ë§ì€ ë‚˜ë¼ëŠ”?', options: ['ì¸ë„', 'ì¤‘êµ­', 'ë¯¸êµ­', 'ì¸ë„ë„¤ì‹œì•„'], answer: 0 },
  { q: 'ìŒì†ë³´ë‹¤ ë¹ ë¥¸ ê²ƒì€?', options: ['ë¹›', 'ì†Œë¦¬', 'ê°™ë‹¤', 'ìƒí™©ì— ë”°ë¼ ë‹¤ë¦„'], answer: 0 },
  { q: 'ì„¸ê³„ 3ëŒ€ í­í¬ê°€ ì•„ë‹Œ ê²ƒì€?', options: ['ì•™í—¬ í­í¬', 'ë‚˜ì´ì•„ê°€ë¼ í­í¬', 'ë¹…í† ë¦¬ì•„ í­í¬', 'ì´ê³¼ìˆ˜ í­í¬'], answer: 0 },
  { q: 'ì›ì†Œ ê¸°í˜¸ FeëŠ” ë¬´ì—‡ì¸ê°€?', options: ['ì² ', 'ê¸ˆ', 'ì€', 'êµ¬ë¦¬'], answer: 0 },
  { q: 'ëª¨ì°¨ë¥´íŠ¸ì˜ ì¶œìƒ êµ­ê°€ëŠ”?', options: ['ì˜¤ìŠ¤íŠ¸ë¦¬ì•„', 'ë…ì¼', 'ì´íƒˆë¦¬ì•„', 'í”„ë‘ìŠ¤'], answer: 0 },
  { q: 'ì¸í„°ë„·ì˜ WWWëŠ” ë¬´ì—‡ì˜ ì•½ìì¸ê°€?', options: ['World Wide Web', 'Western World Web', 'Wide World Web', 'World Web Wide'], answer: 0 },
  { q: 'í•œë°˜ë„ì—ì„œ ê°€ì¥ ë†’ì€ ì‚°ì€?', options: ['ë°±ë‘ì‚°', 'í•œë¼ì‚°', 'ì§€ë¦¬ì‚°', 'ì„¤ì•…ì‚°'], answer: 0 },
  { q: 'ì‚¼êµ­ì‹œëŒ€ì˜ ì„¸ ë‚˜ë¼ê°€ ì•„ë‹Œ ê²ƒì€?', options: ['ê°€ì•¼', 'ê³ êµ¬ë ¤', 'ë°±ì œ', 'ì‹ ë¼'], answer: 0 },
  { q: 'ë‹¬ì— ì²˜ìŒ ë°œì„ ë””ë”˜ ì‚¬ëŒì€?', options: ['ë‹ ì•”ìŠ¤íŠ¸ë¡±', 'ë²„ì¦ˆ ì˜¬ë“œë¦°', 'ìœ ë¦¬ ê°€ê°€ë¦°', 'ì•¨ëŸ° ì…°í¼ë“œ'], answer: 0 },
  { q: 'ì„¸ê³„ì—ì„œ ê°€ì¥ ì‘ì€ ë‚˜ë¼ëŠ”?', options: ['ë°”í‹°ì¹¸', 'ëª¨ë‚˜ì½”', 'ì‚°ë§ˆë¦¬ë…¸', 'ë¦¬íˆí…ìŠˆíƒ€ì¸'], answer: 0 },
  { q: 'ê³µê¸° ì¤‘ ê°€ì¥ ë§ì€ ê¸°ì²´ëŠ”?', options: ['ì§ˆì†Œ', 'ì‚°ì†Œ', 'ì´ì‚°í™”íƒ„ì†Œ', 'ì•„ë¥´ê³¤'], answer: 0 },
  { q: 'í•œêµ­ì˜ ì „í†µ ë°œíš¨ ì‹í’ˆì´ ì•„ë‹Œ ê²ƒì€?', options: ['ì´ˆë°¥', 'ê¹€ì¹˜', 'ëœì¥', 'ì “ê°ˆ'], answer: 0 },
];

/**
 * ë‚ ì§œ ì‹œë“œ ê¸°ë°˜ìœ¼ë¡œ 10ë¬¸í•­ ì„ íƒí•˜ì—¬ í€´ì¦ˆ ìƒì„±
 */
export function getDailyQuizQuestions(seed: SeedContext) {
  const selected = seedPick(QUIZ_POOL, seed.daySeed, 10, 0);
  return selected.map((item, i) => {
    // ë³´ê¸° ìˆœì„œ ì„ê¸° (ì •ë‹µ ìœ„ì¹˜ ë³€ê²½)
    const correctAnswer = item.options[item.answer];
    const shuffledOptions = [...item.options];

    // ì‹œë“œ ê¸°ë°˜ ì…”í”Œ
    for (let j = shuffledOptions.length - 1; j > 0; j--) {
      const k = seedIndex(seed.daySeed, j + 1, i * 100 + j);
      [shuffledOptions[j], shuffledOptions[k]] = [shuffledOptions[k], shuffledOptions[j]];
    }

    const newAnswer = shuffledOptions.indexOf(correctAnswer);

    return {
      id: `quiz_${i}`,
      question: item.q,
      options: shuffledOptions,
      correctIndex: newAnswer,
    };
  });
}

/**
 * í€´ì¦ˆ ê²°ê³¼ ìƒì„±
 */
export function generateQuizResult(
  score: number,
  total: number,
  seed: SeedContext,
): GenerateResultOutput {
  const pct = Math.round((score / total) * 100);

  let grade: string;
  let comment: string;
  if (pct >= 90) {
    grade = 'ì²œì¬ê¸‰';
    comment = 'ê±°ì˜ ì™„ë²½í•œ ì ìˆ˜ë‹¤. ì¼ìƒì—ì„œë„ ì´ ì§‘ì¤‘ë ¥ì„ ë°œíœ˜í•˜ë©´ ì¢‹ê² ë‹¤.';
  } else if (pct >= 70) {
    grade = 'ìš°ë“±ìƒ';
    comment = 'íƒ„íƒ„í•œ ê¸°ë³¸ê¸°ê°€ ëŠê»´ì§„ë‹¤. ì¡°ê¸ˆë§Œ ë” ë‹¤ë“¬ìœ¼ë©´ ë§Œì ë„ ê°€ëŠ¥í•˜ë‹¤.';
  } else if (pct >= 50) {
    grade = 'í‰ê·  ì´ìƒ';
    comment = 'ë‚˜ì˜ì§€ ì•Šì€ ê²°ê³¼ë‹¤. ê´€ì‹¬ ë¶„ì•¼ë¥¼ ë„“í˜€ë³´ë©´ ë” ì¬ë°Œì„ ê²ƒì´ë‹¤.';
  } else if (pct >= 30) {
    grade = 'ë¶„ë°œ í•„ìš”';
    comment = 'ì•„ì§ ì„±ì¥ì˜ ì—¬ì§€ê°€ ë§ë‹¤. í•˜ë‚˜ì”© ì•Œì•„ê°€ëŠ” ì¬ë¯¸ë¥¼ ëŠê»´ë³´ì.';
  } else {
    grade = 'ë„ì „ì';
    comment = 'ì˜¤ëŠ˜ì˜ ì ìˆ˜ëŠ” ì‹œì‘ì¼ ë¿ì´ë‹¤. ë‚´ì¼ ë‹¤ì‹œ ë„ì „í•´ë³´ì.';
  }

  return {
    resultKey: `quiz-${seed.dateStr}-${score}`,
    summary: `${total}ë¬¸í•­ ì¤‘ ${score}ê°œ ì •ë‹µ (${pct}%) - ${grade}`,
    keywords: [grade, `${pct}%`, 'ìƒì‹í€´ì¦ˆ'],
    doToday: 'ëª¨ë¥´ëŠ” ë¶„ì•¼ ê¸°ì‚¬ë¥¼ í•˜ë‚˜ ì½ì–´ë³´ì.',
    avoidToday: 'ì•„ëŠ” ì²™ì€ ì ì‹œ ë‚´ë ¤ë†“ì.',
    detailSections: [
      {
        area: 'score',
        label: 'ì ìˆ˜',
        emoji: 'ğŸ“Š',
        text: `${score} / ${total} (${pct}%)`,
        score: Math.ceil(pct / 20),
      },
      {
        area: 'grade',
        label: 'ë“±ê¸‰',
        emoji: 'ğŸ…',
        text: grade,
      },
      {
        area: 'comment',
        label: 'í•œë§ˆë””',
        emoji: 'ğŸ’¬',
        text: comment,
      },
    ],
    personalDetail: 'ì˜¤ëŠ˜ì˜ í€´ì¦ˆ ê²°ê³¼ê°€ ë‚´ì¼ì€ ë˜ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.',
    shareCard: {
      title: '1ë¶„ ìƒì‹ í€´ì¦ˆ',
      summary: `${score}/${total} ì •ë‹µ - ${grade}`,
      keywords: [grade, `${pct}%`, 'í€´ì¦ˆ'],
    },
    meta: {
      disclaimer: true,
      generatedAt: seed.dateStr,
    },
  };
}
